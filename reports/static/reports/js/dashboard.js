data1 = [
	{
		"date_from": "2022-10-31",
		"date_to": "2022-11-06",
		"week_num": 44,
		"revenue": 16192.36,
		"sales_amount": 32,
		"returns_amount": 0,
		"logistics": 8332.5,
		"net_costs_sum": 3200,
		"marginality": 80.23759353176436,
		"commission": 3189.110000000004,
		"supplier_costs": 30000,
		"wb_costs": 880,
		"tax": 1133.4652,
		"profit": -30042.715200000002,
		"profitability": -188.62423513311217
	},
	{
		"date_from": "2022-11-07",
		"date_to": "2022-11-13",
		"week_num": 45,
		"revenue": 74653.4200000003,
		"sales_amount": 176,
		"returns_amount": 0,
		"logistics": 17471,
		"net_costs_sum": 17600,
		"marginality": 76.42438886255991,
		"commission": 6207.160000000338,
		"supplier_costs": 0,
		"wb_costs": 21930,
		"tax": 5225.739400000013,
		"profit": 6219.5205999999525,
		"profitability": 8.331193132210055
	},
	{
		"date_from": "2022-11-14",
		"date_to": "2022-11-20",
		"week_num": 46,
		"revenue": 91088.41000000032,
		"sales_amount": 209,
		"returns_amount": 0,
		"logistics": 22828,
		"net_costs_sum": 20900,
		"marginality": 77.05525873159942,
		"commission": 12742.530000000246,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 6376.188700000013,
		"profit": 28241.691300000064,
		"profitability": 31.00470334260963
	},
	{
		"date_from": "2022-11-21",
		"date_to": "2022-11-27",
		"week_num": 47,
		"revenue": 186608.009999999,
		"sales_amount": 495,
		"returns_amount": 0,
		"logistics": 34896,
		"net_costs_sum": 49500,
		"marginality": 73.47380747482369,
		"commission": 15728.859999999171,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 13062.560699999987,
		"profit": 73420.58929999983,
		"profitability": 39.34482196128678
	},
	{
		"date_from": "2022-11-28",
		"date_to": "2022-12-04",
		"week_num": 48,
		"revenue": 151317.65000000005,
		"sales_amount": 403,
		"returns_amount": 1,
		"logistics": 23679.5,
		"net_costs_sum": 40200,
		"marginality": 73.43337013230116,
		"commission": 7270.210000000156,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 10592.23550000001,
		"profit": 69575.70449999989,
		"profitability": 45.979900229748395
	},
	{
		"date_from": "2022-12-05",
		"date_to": "2022-12-11",
		"week_num": 49,
		"revenue": 112608.10999999988,
		"sales_amount": 228,
		"returns_amount": 0,
		"logistics": 15328,
		"net_costs_sum": 22800,
		"marginality": 79.75279045177118,
		"commission": 26332.02999999997,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 7882.567700000008,
		"profit": 40265.51229999991,
		"profitability": 35.757204609863315
	},
	{
		"date_from": "2022-12-12",
		"date_to": "2022-12-18",
		"week_num": 50,
		"revenue": 157598.46999999988,
		"sales_amount": 268,
		"returns_amount": 0,
		"logistics": 18804,
		"net_costs_sum": 26800,
		"marginality": 82.99475876891444,
		"commission": 34685.47999999997,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 11031.892900000006,
		"profit": 66277.09709999991,
		"profitability": 42.05440389110374
	},
	{
		"date_from": "2022-12-19",
		"date_to": "2022-12-25",
		"week_num": 51,
		"revenue": 153829.11000000002,
		"sales_amount": 250,
		"returns_amount": 0,
		"logistics": 10136,
		"net_costs_sum": 25000,
		"marginality": 83.74819954428652,
		"commission": 34619.35000000009,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 10768.037700000003,
		"profit": 73230.72229999992,
		"profitability": 47.60524344189466
	},
	{
		"date_from": "2022-12-26",
		"date_to": "2022-12-28",
		"week_num": 52,
		"revenue": 61496.36999999995,
		"sales_amount": 95,
		"returns_amount": 0,
		"logistics": 4770,
		"net_costs_sum": 9500,
		"marginality": 84.5519337157624,
		"commission": 13862.07999999998,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 4304.745899999999,
		"profit": 29059.544099999974,
		"profitability": 47.25408036279214
	},
	{
		"date_from": "2022-12-29",
		"date_to": "2023-01-01",
		"week_num": 52,
		"revenue": 67709.83999999997,
		"sales_amount": 105,
		"returns_amount": 0,
		"logistics": 3392.5,
		"net_costs_sum": 10500,
		"marginality": 84.4926527665698,
		"commission": 15381.089999999938,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 4739.688799999995,
		"profit": 33696.56120000003,
		"profitability": 49.766121438183944
	},
	{
		"date_from": "2023-01-02",
		"date_to": "2023-01-08",
		"week_num": 1,
		"revenue": 94066.55000000013,
		"sales_amount": 145,
		"returns_amount": 0,
		"logistics": 11071.5,
		"net_costs_sum": 14500,
		"marginality": 84.58538130717031,
		"commission": 21185.06000000013,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 6584.658499999989,
		"profit": 40600.331500000015,
		"profitability": 43.16128474999876
	},
	{
		"date_from": "2023-01-09",
		"date_to": "2023-01-15",
		"week_num": 2,
		"revenue": 112628.84000000019,
		"sales_amount": 179,
		"returns_amount": 0,
		"logistics": 10769.36,
		"net_costs_sum": 17900,
		"marginality": 84.10709015559428,
		"commission": 25336.260000000228,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 7884.018799999969,
		"profit": 50639.20119999999,
		"profitability": 44.96113180247608
	},
	{
		"date_from": "2023-01-16",
		"date_to": "2023-01-22",
		"week_num": 3,
		"revenue": 119971.36000000018,
		"sales_amount": 187,
		"returns_amount": 0,
		"logistics": 10586.200000000003,
		"net_costs_sum": 18700,
		"marginality": 84.41294655657819,
		"commission": 27106.620000000228,
		"supplier_costs": 0,
		"wb_costs": 0,
		"tax": 8397.995199999961,
		"profit": 55196.54479999998,
		"profitability": 46.0081012668356
	}
]



let bars_x = 0;
let bars_x_offset = 0;

let bars_y = 0;
let bars_y_offset = document.querySelector('.graphs-bar__info-add').offsetHeight;

function createBar(data_bar) {

	// Блоки с контентом
	let bar_div_revenue = document.querySelector('.graphs-bar__revenue');
	let bar_div_profit = document.querySelector('.graphs-bar__profit');

	let bar_div_count = document.querySelector('.graphs-bar__count');

	// Количество блоков
	let bar_count = data_bar.length;

	// Получение максимальной высоту графика
	let bar_max_height = document.querySelector('.graphs-bar__profit-item-check').clientHeight;


	bar_div_revenue.innerHTML = '';


	let bar_pb_el = document.querySelector('.graphs-bar__bars');
	let bar_pb = window.getComputedStyle(bar_pb_el, null).getPropertyValue("padding-bottom");



	let bar_revenue_min = 0;
	let bar_revenue_max = 0;

	let bar_profit_min = 0;
	let bar_profit_max = 0;

	for (var i = 0; i < bar_count; i++) {

		if (data_bar[i]['revenue'] > bar_revenue_max) {
			bar_revenue_max = data_bar[i]['revenue'];
		}

		if (data_bar[i]['revenue'] < bar_revenue_min) {
			bar_revenue_min = data_bar[i]['revenue'];
		}

		if (data_bar[i]['profit'] > bar_profit_max) {
			bar_profit_max = data_bar[i]['profit'];
		}

		if (data_bar[i]['profit'] < bar_profit_min) {
			bar_profit_min = data_bar[i]['profit'];
		}
	}

	let bar_max_value = bar_revenue_max;
	if (bar_profit_min < 0) {
		bar_max_value = bar_max_value + (-1 * bar_profit_min);
	}

	let bar_revenue_percent = bar_max_height / bar_max_value;

	// Добавить отсуп снизу, если есть отрицальное значение
	if (bar_profit_min < 0) {
		height = bar_revenue_percent * bar_profit_min * -1;
		value = String(height) +'px + '+ bar_pb;

		bar_pb_el.style.paddingBottom = 'calc('+value+')';
		bar_div_profit.style.bottom = 'calc('+value+')';

		bars_y = Number(height) + Number(bar_pb.slice(0, -2));
	}

	bar_div_count.innerHTML = '';

	for (var i = 0; i < bar_count; i++) {

		addsLeftRight = '';
		if ((i == 0) || (i == 1)) {
			addsLeftRight = 'data-position="left"';
		} else if ((i == (bar_count-1)) || (i == bar_count-2)) {
			addsLeftRight = 'data-position="right"';
		}

		attrs = 'data-date_from="'+data_bar[i]['date_from']+'" ' +'data-date_to="'+data_bar[i]['date_to']+'" ' +'data-week_num="'+data_bar[i]['week_num']+'" ' +'data-revenue="'+Math.round(data_bar[i]['revenue']).toLocaleString()+'" ' +'data-sales_amount="'+Math.round(data_bar[i]['sales_amount']).toLocaleString()+'" ' +'data-returns_amount="'+Math.round(data_bar[i]['returns_amount']).toLocaleString()+'" ' +'data-logistics="'+Math.round(data_bar[i]['logistics']).toLocaleString()+'" ' +'data-net_costs_sum="'+Math.round(data_bar[i]['net_costs_sum']).toLocaleString()+'" ' +'data-marginality="'+Math.round(data_bar[i]['marginality']).toLocaleString()+'" ' +'data-commission="'+Math.round(data_bar[i]['commission']).toLocaleString()+'" ' +'data-supplier_costs="'+Math.round(data_bar[i]['supplier_costs']).toLocaleString()+'" ' +'data-wb_costs="'+Math.round(data_bar[i]['wb_costs']).toLocaleString()+'" ' +'data-tax="'+Math.round(data_bar[i]['tax']).toLocaleString()+'" ' +'data-profit="'+Math.round(data_bar[i]['profit']).toLocaleString()+'" ' +'data-profitability="'+Math.round(data_bar[i]['profitability']).toLocaleString()+'" ';

		current_revenue_percent = data_bar[i]['revenue'] * bar_revenue_percent;
		bar_div_revenue.innerHTML += '<div '+addsLeftRight+' '+attrs+' class="graphs-bar__revenue-item" style="height: ' + current_revenue_percent + 'px"></div>';


		if (data_bar[i]['profit'] >= 0) {
			current_profit_percent = data_bar[i]['profit'] * bar_revenue_percent;
			bar_div_profit.innerHTML += '<div '+addsLeftRight+' '+attrs+' class="graphs-bar__profit-item" style="height: ' + current_profit_percent + 'px"></div>';
		} else {
			current_profit_percent = data_bar[i]['profit'] * bar_revenue_percent * -1;
			bar_div_profit.innerHTML += '<div '+addsLeftRight+' '+attrs+' class="graphs-bar__profit-item border-radius-bottom" style="height: ' + current_profit_percent + 'px; transform: translateY('+current_profit_percent+'px)"></div>';

		}



		bar_div_count.innerHTML += '<span class="graphs-bar__count-item">'+data_bar[i]['week_num']+'</span>';
	}

	// Обработка события наведения и получение информациb

	showBarInfo();

}



// Открытие подсказки
let bar_tooltip = document.querySelector('.graphs-bar__tooltip-info');

document.addEventListener('click', function(e) {
	target = e.target.classList;

	if (target.contains('graphs-bar__tooltip-btn') || target.contains('graphs-bar__tooltip-info')) {
		if (target.contains('graphs-bar__tooltip-btn')) {
			if (bar_tooltip.classList.contains('showed')) {
				bar_tooltip.classList.remove('showed');
			} else {
				bar_tooltip.classList.add('showed');
			}
		} else {
			bar_tooltip.classList.add('showed');
		}

	} else {
		bar_tooltip.classList.remove('showed');
	}
});


// Логика работы всплывающего окна с информацией

let bar_info = document.querySelector('.graphs-bar__info');

let screen_width = window.innerWidth;

if (screen_width <= 480) {
	bar_info.classList.add('graphs-bar__info-480px');
} else if (screen_width <= 768) {
	bar_info.classList.add('graphs-bar__info-768px');
}



function showBarInfo() {

	var bars_profit = document.getElementsByClassName('graphs-bar__profit-item');
	var bars_revenue = document.getElementsByClassName('graphs-bar__revenue-item');

	let bars_info_title = document.querySelector('.graphs-bar__info-title');
	let bars_info_span = document.getElementsByClassName('graphs-bar__info-span');

	let bars_add = document.querySelector('.graphs-bar__info-add');

	for(var i = 0; i < bars_profit.length; i++) {
		bars_profit[i].addEventListener('mouseover', function(e) {

			result = [];
			result.push(this.getAttribute('data-date_from'));
			result.push(this.getAttribute('data-date_to'));
			result.push(this.getAttribute('data-week_num'));
			result.push(this.getAttribute('data-revenue'));
			result.push(this.getAttribute('data-sales_amount'));
			result.push(this.getAttribute('data-returns_amount'));
			result.push(this.getAttribute('data-logistics'));
			result.push(this.getAttribute('data-net_costs_sum'));
			result.push(this.getAttribute('data-marginality'));
			result.push(this.getAttribute('data-commission'));
			result.push(this.getAttribute('data-supplier_costs'));
			result.push(this.getAttribute('data-wb_costs'));
			result.push(this.getAttribute('data-tax'));
			result.push(this.getAttribute('data-profit'));
			result.push(this.getAttribute('data-profitability'));

			bars_info_title.textContent = result[0] + ' - ' + result[1];

			bars_info_span[0].textContent = result[13];
			bars_info_span[1].textContent = result[8];
			bars_info_span[2].textContent = result[14];
			bars_info_span[3].textContent = result[4];
			bars_info_span[4].textContent = result[5];
			bars_info_span[5].textContent = result[3];
			bars_info_span[6].textContent = result[7];
			bars_info_span[7].textContent = result[9];
			bars_info_span[8].textContent = result[6];
			bars_info_span[9].textContent = result[11];
			bars_info_span[10].textContent = result[10];
			bars_info_span[11].textContent = result[12];


			/*if (screen_width <= 480) {
				bar_info.style.bottom = '' + String(-1*(bars_y-(bars_y_offset/2)) +10) + 'px';

				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);

				bars_add.style.left = '' + bars_x +'px';


			} else if (screen_width <= 768) {

				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bar_info.style.left = '' + bars_x +'px';

				position = this.getAttribute('data-position');
				if (position == 'left') {
					bar_info.style.left = 0;

					bar_info.classList.add('left768px');
					bars_add.style.left = '' + bars_x +'px';

					bars_add.style.transform = 'translateX(-50%)';

				} else if (position == 'right') {
					bar_info.style.left = 'auto';
					bar_info.style.right = '0';

					bar_info.classList.add('right768px');
					bars_add.style.left = 'auto';


					bars_x = this.offsetLeft;

					max_width_temp = document.querySelector('.graphs-bar').offsetWidth;

					bars_add.style.right = '' + (max_width_temp - bars_x - this.getBoundingClientRect().width / 2) +'px';
					bars_add.style.transform = 'translateX(50%)';

				} else {
					bar_info.classList.remove('left768px');
					bar_info.classList.remove('right768px');
					bars_add.style.left = '50%';

					bars_add.style.transform = 'translateX(-50%)';
				}

				bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			} else {
				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bar_info.style.left = '' + bars_x +'px';
				bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			}*/

			bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
			bar_info.style.left = '' + bars_x +'px';
			bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			bar_info.classList.add('showed');
		});

		bars_profit[i].addEventListener('mouseleave', function() {
			bar_info.classList.remove('showed');
		});



		bars_revenue[i].addEventListener('mouseover', function() {

			result = [];
			result.push(this.getAttribute('data-date_from'));
			result.push(this.getAttribute('data-date_to'));
			result.push(this.getAttribute('data-week_num'));
			result.push(this.getAttribute('data-revenue'));
			result.push(this.getAttribute('data-sales_amount'));
			result.push(this.getAttribute('data-returns_amount'));
			result.push(this.getAttribute('data-logistics'));
			result.push(this.getAttribute('data-net_costs_sum'));
			result.push(this.getAttribute('data-marginality'));
			result.push(this.getAttribute('data-commission'));
			result.push(this.getAttribute('data-supplier_costs'));
			result.push(this.getAttribute('data-wb_costs'));
			result.push(this.getAttribute('data-tax'));
			result.push(this.getAttribute('data-profit'));
			result.push(this.getAttribute('data-profitability'));

			bars_info_title.textContent = result[0] + ' - ' + result[1];

			bars_info_span[0].textContent = result[13];
			bars_info_span[1].textContent = result[8];
			bars_info_span[2].textContent = result[14];
			bars_info_span[3].textContent = result[4];
			bars_info_span[4].textContent = result[5];
			bars_info_span[5].textContent = result[3];
			bars_info_span[6].textContent = result[7];
			bars_info_span[7].textContent = result[9];
			bars_info_span[8].textContent = result[6];
			bars_info_span[9].textContent = result[11];
			bars_info_span[10].textContent = result[10];
			bars_info_span[11].textContent = result[12];


			/*if (screen_width <= 480) {
				bar_info.style.bottom = '' + String(-1*(bars_y-(bars_y_offset/2)) +10) + 'px';

				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);

				bars_add.style.left = '' + bars_x +'px';


			} else if (screen_width <= 768) {

				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bar_info.style.left = '' + bars_x +'px';

				position = this.getAttribute('data-position');
				if (position == 'left') {
					bar_info.style.left = 0;

					bar_info.classList.add('left768px');
					bars_add.style.left = '' + bars_x +'px';

					bars_add.style.transform = 'translateX(-50%)';

				} else if (position == 'right') {
					bar_info.style.left = 'auto';
					bar_info.style.right = '0';

					bar_info.classList.add('right768px');
					bars_add.style.left = 'auto';


					bars_x = this.offsetLeft;

					max_width_temp = document.querySelector('.graphs-bar').offsetWidth;

					bars_add.style.right = '' + (max_width_temp - bars_x - this.getBoundingClientRect().width / 2) +'px';
					bars_add.style.transform = 'translateX(50%)';

				} else {
					bar_info.classList.remove('left768px');
					bar_info.classList.remove('right768px');
					bars_add.style.left = '50%';

					bars_add.style.transform = 'translateX(-50%)';
				}

				bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			} else {
				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bar_info.style.left = '' + bars_x +'px';
				bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			}*/

			bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
			bar_info.style.left = '' + bars_x +'px';
			bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			bar_info.classList.add('showed');



			/*if (screen_width <= 480) {
				bar_info.style.bottom = '' + String(-1*(bars_y-(bars_y_offset/2)) +10) + 'px';

				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bars_add.style.left = '' + bars_x +'px';


			} else if (screen_width <= 768) {

			} else {
				bars_x = this.offsetLeft + (this.getBoundingClientRect().width / 2);
				bar_info.style.left = '' + bars_x +'px';
				bar_info.style.bottom = '' + String(bars_y-(bars_y_offset/2)) + 'px';

			}

			bar_info.classList.add('showed');*/

		});

		bars_revenue[i].addEventListener('mouseleave', function() {
			bar_info.classList.remove('showed');
		});
	}

}



var diog_data1 = {
	"Коледино": 64.52852239495367,
	"Склад Казань": 7.444979651992475,
	"Краснодар": 6.102747704352554,
	"Электросталь": 5.946136807622129,
	"Новосибирск": 5.640040478121926,
	"Санкт-Петербург Ш блок 1": 5.571520576438181,
	"Екатеринбург": 3.8970308304551766,
	"null": 0.39724211539265253,
	"остальные": 0.47177944067179695
}

var diog_current_title = '';

function createDiogram(data, position) {

	let cur_block = 'diog-' + position;

	let diog_content = document.getElementById(cur_block);

	let diog_labeles = [];
	let diog_data = [];

	for (key in data) {
		diog_labeles.push(key);
		diog_data.push(data[key]);
	}

	let diog_legend_block = 'graphs-diog__legend-' + position;
	diog_legend_block = document.getElementById(diog_legend_block).children;

	for(var i = 0; i < diog_labeles.length; i++) {
		diog_legend_block[i].children[1].textContent = diog_labeles[i];
	}

	new Chart(diog_content, {
		type: 'doughnut',
		data: {
			labels: diog_labeles,
			datasets: [{
				label: '',
				data: diog_data,
				backgroundColor: [
					'#ff562b',
					'#ff815c',
					'#ffa78b',
					'#ffcabc',
					'#edecec',
					'#dfe5e9',
					'#d6dde6',
					'#b9cee2',
					'#c1d2e3',
				],
			}
			]},
		options: {


			legend: {
				display: false
			},

			tooltips: {
				mode: 'nearest',
				caretSize: 0,
				callbacks: {
					title: function(tooltipItem, data) {
						diog_current_title = data['labels'][tooltipItem[0]['index']];
					},
					label: function(tooltipItem, data) {
						return diog_current_title;
					},
				},
				titleFontColor: '#0066ff',
				bodyFontSize: 8,
				displayColors: false,
				backgroundColor: 'rgba(0, 0, 0, 1)',



			}
		}



	});

}

createBar(data1);

createDiogram(diog_data1, 'left');
createDiogram(diog_data1, 'right');
